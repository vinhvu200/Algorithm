public class Solution {

	// Attempt
	// Dynamic Programming
	// Time : O(n/2) * O(n) * O(n/2) = O(n^3)
	// Space : O(n^2)
	// Result : 221/229 cases passed.. Time Limit Exceeded
	public static int longestValidParentheses(String s) {
	
		boolean array[][] = new boolean[s.length()][s.length()];
		boolean flag = false;
		int row=0, col=1;

		while (col < s.length()) {
		
			if (s.charAt(row) == '(' && s.charAt(col) == ')') {
			
				flag = true;
				array[row][col] = true;
			}
			else 
				array[row][col] = false;
			row++; col++;
		}

		if (flag == false)
			return 0;

		int max = 2;
		int iteration = s.length() / 2;
		int t_row=0, t_col=0;

		for (int i=1; i<iteration; i++) {
		
			row = 0;
			col = 2*i+1;

			while (col < s.length()) {
			
				flag = false;

				if (s.charAt(col-1) == '(' && s.charAt(col) == ')') {
				
					if (array[row][col-2] == true) {
						flag = true;
						array[row][col] = true;
						if (col-row+1 > max)
							max = col-row+1;

					}
				}
				if (s.charAt(row) == '(' && s.charAt(col) == ')') {
				
					if (array[row+1][col-1] == true) {
						flag = true;
						array[row][col] = true;
						if (col-row+1 > max)
							max = col-row+1;
					}
				}
				t_row = row+2;
				t_col = row+1;

				if (flag == false) {
					while (t_col < col) {
						
						if (array[row][t_col] == true && array[t_row][col] == true) {
						
							array[row][col] = true;
							if (col-row+1 > max)
								max = col-row+1;
						}
						t_row += 2;
						t_col += 2;
					}
				}

				row++; col++;
			}
		}

		return max;
	}

	public static void main(String[] args) {
	
		String s = "()(())";
		String s1 = "))))))()((()(((()((()((())()((()))()()(()()))))()())()))())())))(((()()()()(()()))()((()))))()(()()(((()())(((())(((())((()))))()(()(())(()(()(((((())(())))(()))())(((((())))))))()(())((((((()())()))))(()))(((()()(()(())()((())))()(())))())()())((((()))))()()((((((())()((((()(())((((()()())(())()())))()(()((())))))))()())((((()))())())))()))((())))()((()(())((()((())))((())((()())()))))())))())(((((((()))(((())(((()((()))(((()(())))((((()()())))))))())()))(()))())))()(()))((())()))((())))((())(()())(((()((()()))))()()(())))))()))))()((()((()(((()())(((())))(()(())())))((((((()()()))))((()))))(()(())()(()((())((()))()()()()(()((()())((((())()((()()))()))))()(((()())())))(()(((()()))()())))()()))))((()((((()(()))()(()()(((()()()()())((())()(((())(())))))()))))()())()()())(())))((())(()))(((())()))))))())()())((()((()()(())))())((()(((()(((((()(())(())()()))()))(()((((((((()(()()))()(()(()))(())(())())))))(())))))))()))))()())()()(((())()))((()))))))(())((()))(()((()()())())((()))))((()()())(()(((()))))(())(((()(()()()()((())())(())()))()())))())))()(((()))(()))()))()((((()()()(()(()))(((())()()(((())()((()(())((())())(((()()))((()())))())(()(())(()()))(((()(())(())))(()())(()()()()(()((()()()))(())(()(((()())))()((((())()())((()(()(())))(()()(()(()))))))(()())((()))()))()(()))((()()))))()()()))(())(())(())))()(()))(()()(((()((((())())))(()(())(()()))))))((()((()()))())))((((((())()))())(())())(()()(()(()()))()))((()((())(()((()(())))()((()))()(((()()()())()((())))(()()()()(()((()()((()((()()()(()(((())))))(())(()()(()())((((()()()()((()(())()(((()))(()(())(((()())())((()()))(";
		long start = System.nanoTime();
		System.out.println(longestValidParentheses(s1));
		long end = System.nanoTime();
		long duration = (end - start) / 1000000;
		System.out.println("duration : " + duration + "ms");
	}
}
